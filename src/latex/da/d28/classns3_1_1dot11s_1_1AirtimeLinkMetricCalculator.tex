\hypertarget{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator}{}\section{ns3\+:\+:dot11s\+:\+:Airtime\+Link\+Metric\+Calculator Class Reference}
\label{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator}\index{ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator@{ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator}}


Airtime link metric calculator.  




{\ttfamily \#include $<$airtime-\/metric.\+h$>$}



Inheritance diagram for ns3\+:\+:dot11s\+:\+:Airtime\+Link\+Metric\+Calculator\+:
% FIG 0


Collaboration diagram for ns3\+:\+:dot11s\+:\+:Airtime\+Link\+Metric\+Calculator\+:
% FIG 1
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_ab3d660bd793115799e83e1296ecbed47}{Airtime\+Link\+Metric\+Calculator} ()
\item 
uint32\+\_\+t \hyperlink{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_a72c6cb74bc18c3d3faf86a1da79c9afd}{Calculate\+Metric} (\hyperlink{classns3_1_1Mac48Address}{Mac48\+Address} peer\+Address, \hyperlink{classns3_1_1Ptr}{Ptr}$<$ \hyperlink{classns3_1_1MeshWifiInterfaceMac}{Mesh\+Wifi\+Interface\+Mac} $>$ mac)
\end{DoxyCompactItemize}
\subsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static \hyperlink{classns3_1_1TypeId}{Type\+Id} \hyperlink{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_af622528b17c03be70643f061a7e8293c}{Get\+Type\+Id} ()
\begin{DoxyCompactList}\small\item\em Get the type ID. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_abcae7234079e2c8ca360d8fb2b1e85d9}{Set\+Test\+Length} (uint16\+\_\+t test\+Length)
\item 
void \hyperlink{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_aa6cca3c42a0677e2b168275d88e19dbb}{Set\+Header\+Tid} (uint8\+\_\+t tid)
\end{DoxyCompactItemize}
\subsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classns3_1_1Ptr}{Ptr}$<$ \hyperlink{classns3_1_1Packet}{Packet} $>$ \hyperlink{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_a28cc4e99da4ac3b38604bc512903b677}{m\+\_\+test\+Frame}
\begin{DoxyCompactList}\small\item\em test frame \end{DoxyCompactList}\item 
\hyperlink{classns3_1_1WifiMacHeader}{Wifi\+Mac\+Header} \hyperlink{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_ab0ae80f5adbf2dedd3346a934baf5943}{m\+\_\+test\+Header}
\begin{DoxyCompactList}\small\item\em test header \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Additional Inherited Members}


\subsection{Detailed Description}
Airtime link metric calculator. 

Airtime link metric is defined in 11\+B.\+10 of 802.\+11s Draft D3.\+0 as\+:

airtime = (O + Bt/r)$\ast$ (1 + average retry counter), where\+:
\begin{DoxyItemize}
\item o -- the P\+HY dependent channel access which includes frame headers, training sequences, access protocol frames, etc.
\item bt -- the test packet length in bits (8192 by default),
\item r -- the current bitrate of the packet,
\end{DoxyItemize}

Final result is expressed in units of 0.\+01 \hyperlink{classns3_1_1Time}{Time} Unit = 10.\+24 us (as required by 802.\+11s draft) 

\subsection{Constructor \& Destructor Documentation}
\index{ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator@{ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator}!Airtime\+Link\+Metric\+Calculator@{Airtime\+Link\+Metric\+Calculator}}
\index{Airtime\+Link\+Metric\+Calculator@{Airtime\+Link\+Metric\+Calculator}!ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator@{ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator}}
\subsubsection[{\texorpdfstring{Airtime\+Link\+Metric\+Calculator()}{AirtimeLinkMetricCalculator()}}]{\setlength{\rightskip}{0pt plus 5cm}ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator\+::\+Airtime\+Link\+Metric\+Calculator (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_ab3d660bd793115799e83e1296ecbed47}{}\label{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_ab3d660bd793115799e83e1296ecbed47}

\begin{DoxyCode}
53 \{
54 \}
\end{DoxyCode}


\subsection{Member Function Documentation}
\index{ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator@{ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator}!Calculate\+Metric@{Calculate\+Metric}}
\index{Calculate\+Metric@{Calculate\+Metric}!ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator@{ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator}}
\subsubsection[{\texorpdfstring{Calculate\+Metric(\+Mac48\+Address peer\+Address, Ptr$<$ Mesh\+Wifi\+Interface\+Mac $>$ mac)}{CalculateMetric(Mac48Address peerAddress, Ptr< MeshWifiInterfaceMac > mac)}}]{\setlength{\rightskip}{0pt plus 5cm}uint32\+\_\+t ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator\+::\+Calculate\+Metric (
\begin{DoxyParamCaption}
\item[{{\bf Mac48\+Address}}]{peer\+Address, }
\item[{{\bf Ptr}$<$ {\bf Mesh\+Wifi\+Interface\+Mac} $>$}]{mac}
\end{DoxyParamCaption}
)}\hypertarget{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_a72c6cb74bc18c3d3faf86a1da79c9afd}{}\label{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_a72c6cb74bc18c3d3faf86a1da79c9afd}
Airtime link metric is defined in Section 13.\+9 of I\+E\+EE 802.\+11-\/2012 as\+:

airtime = (O + Bt/r) / (1 -\/ frame error rate), where o -- the P\+HY dependent channel access which includes frame headers, training sequences, access protocol frames, etc. bt -- the test packet length in bits (8192 by default), r -- the current bitrate of the packet,

Final result is expressed encoded as an unsigned integer in units of 0.\+01 TU = 10.\+24 us


\begin{DoxyParams}{Parameters}
{\em peer\+Address} & The peer M\+AC address \\
\hline
{\em mac} & The M\+AC layer \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the calculated metric in units of 0.\+01 TU 
\end{DoxyReturn}

\begin{DoxyCode}
70 \{
71   \textcolor{comment}{/* Airtime link metric is defined in Section 13.9 of 802.11-2012 as:}
72 \textcolor{comment}{   *}
73 \textcolor{comment}{   * airtime = (O + Bt/r) /  (1 - frame error rate), where}
74 \textcolor{comment}{   * o  -- the PHY dependent channel access which includes frame headers, training sequences,}
75 \textcolor{comment}{   *       access protocol frames, etc.}
76 \textcolor{comment}{   * bt -- the test packet length in bits (8192 by default),}
77 \textcolor{comment}{   * r  -- the current bitrate of the packet,}
78 \textcolor{comment}{   *}
79 \textcolor{comment}{   * Final result is expressed in units of 0.01 Time Unit = 10.24 us (as required by 802.11s draft)}
80 \textcolor{comment}{   */}
81   \hyperlink{assert_8h_a6dccdb0de9b252f60088ce281c49d052}{NS\_ASSERT} (!peerAddress.IsGroup ());
82   \textcolor{comment}{//obtain current rate:}
83   WifiMode mode = mac->GetWifiRemoteStationManager ()->GetDataTxVector (peerAddress, &
      \hyperlink{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_ab0ae80f5adbf2dedd3346a934baf5943}{m\_testHeader}, \hyperlink{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_a28cc4e99da4ac3b38604bc512903b677}{m\_testFrame}).GetMode();
84   \textcolor{comment}{//obtain frame error rate:}
85   \textcolor{keywordtype}{double} failAvg = mac->GetWifiRemoteStationManager ()->GetInfo (peerAddress).GetFrameErrorRate ();
86   \textcolor{keywordflow}{if} (failAvg == 1)
87     \{
88       \textcolor{comment}{// Return max metric value when frame error rate equals to 1}
89       \textcolor{keywordflow}{return} (uint32\_t) 0xffffffff;
90     \}
91   \hyperlink{assert_8h_a6dccdb0de9b252f60088ce281c49d052}{NS\_ASSERT} (failAvg < 1.0);
92   WifiTxVector txVector;
93   txVector.SetMode (mode);
94   txVector.SetPreambleType (\hyperlink{group__wifi_gga5e94a56cb338a14ffbbb19c6a41251eba12f3d9468d1630bd38bbef20df1e3eda}{WIFI\_PREAMBLE\_LONG});
95   \textcolor{comment}{//calculate metric}
96   uint32\_t metric = (uint32\_t)((\textcolor{keywordtype}{double})( \textcolor{comment}{/*Overhead + payload*/}
97                                  mac->GetPifs () + mac->GetSlot () + mac->GetEifsNoDifs () + \textcolor{comment}{//DIFS + SIFS
       + AckTxTime = PIFS + SLOT + EifsNoDifs}
98                                  mac->GetWifiPhy ()->CalculateTxDuration (
      \hyperlink{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_a28cc4e99da4ac3b38604bc512903b677}{m\_testFrame}->\hyperlink{classns3_1_1Packet_a462855c9929954d4301a4edfe55f4f1c}{GetSize} (), txVector, mac->GetWifiPhy ()->GetFrequency())
99                                  ).GetMicroSeconds () / (10.24 * (1.0 - failAvg)));
100   \textcolor{keywordflow}{return} metric;
101 \}
\end{DoxyCode}


Here is the call graph for this function\+:
% FIG 2




Here is the caller graph for this function\+:
% FIG 3


\index{ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator@{ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator}!Get\+Type\+Id@{Get\+Type\+Id}}
\index{Get\+Type\+Id@{Get\+Type\+Id}!ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator@{ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator}}
\subsubsection[{\texorpdfstring{Get\+Type\+Id()}{GetTypeId()}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Type\+Id} ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator\+::\+Get\+Type\+Id (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_af622528b17c03be70643f061a7e8293c}{}\label{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_af622528b17c03be70643f061a7e8293c}


Get the type ID. 

\begin{DoxyReturn}{Returns}
the object \hyperlink{classns3_1_1TypeId}{Type\+Id} 
\end{DoxyReturn}

\begin{DoxyCode}
30 \{
31   \textcolor{keyword}{static} TypeId tid = TypeId (\textcolor{stringliteral}{"ns3::dot11s::AirtimeLinkMetricCalculator"})
32     .SetParent<\hyperlink{classns3_1_1Object_a40860402e64d8008fb42329df7097cdb}{Object}> ()
33     .SetGroupName (\textcolor{stringliteral}{"Mesh"})
34     .AddConstructor<\hyperlink{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_ab3d660bd793115799e83e1296ecbed47}{AirtimeLinkMetricCalculator}> ()
35     .AddAttribute ( \textcolor{stringliteral}{"TestLength"},
36                     \textcolor{stringliteral}{"Number of bytes in test frame (a constant 1024 in the standard)"},
37                     UintegerValue (1024),
38                     MakeUintegerAccessor (
39                       &\hyperlink{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_abcae7234079e2c8ca360d8fb2b1e85d9}{AirtimeLinkMetricCalculator::SetTestLength}
      ),
40                     MakeUintegerChecker<uint16\_t> (1)
41                     )
42     .AddAttribute ( \textcolor{stringliteral}{"Dot11MetricTid"},
43                     \textcolor{stringliteral}{"TID used to calculate metric (data rate)"},
44                     UintegerValue (0),
45                     MakeUintegerAccessor (
46                       &\hyperlink{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_aa6cca3c42a0677e2b168275d88e19dbb}{AirtimeLinkMetricCalculator::SetHeaderTid}),
47                     MakeUintegerChecker<uint8\_t> (0)
48                     )
49   ;
50   \textcolor{keywordflow}{return} tid;
51 \}
\end{DoxyCode}


Here is the call graph for this function\+:
% FIG 4


\index{ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator@{ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator}!Set\+Header\+Tid@{Set\+Header\+Tid}}
\index{Set\+Header\+Tid@{Set\+Header\+Tid}!ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator@{ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator}}
\subsubsection[{\texorpdfstring{Set\+Header\+Tid(uint8\+\_\+t tid)}{SetHeaderTid(uint8_t tid)}}]{\setlength{\rightskip}{0pt plus 5cm}void ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator\+::\+Set\+Header\+Tid (
\begin{DoxyParamCaption}
\item[{uint8\+\_\+t}]{tid}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\hypertarget{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_aa6cca3c42a0677e2b168275d88e19dbb}{}\label{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_aa6cca3c42a0677e2b168275d88e19dbb}
Set header T\+ID from the Dot11\+Metric\+Tid attribute 
\begin{DoxyParams}{Parameters}
{\em tid} & the header T\+ID to use to calculate data rate \\
\hline
\end{DoxyParams}

\begin{DoxyCode}
57 \{
58   \hyperlink{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_ab0ae80f5adbf2dedd3346a934baf5943}{m\_testHeader}.\hyperlink{classns3_1_1WifiMacHeader_ac4ec5b433a2701eae9cffb61b06ecec1}{SetDsFrom} ();
59   \hyperlink{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_ab0ae80f5adbf2dedd3346a934baf5943}{m\_testHeader}.\hyperlink{classns3_1_1WifiMacHeader_a577e95535beca95ba7f4a61a61e8b17d}{SetDsTo} ();
60   \hyperlink{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_ab0ae80f5adbf2dedd3346a934baf5943}{m\_testHeader}.\hyperlink{classns3_1_1WifiMacHeader_a8bc4915d867ea16df7c110a87c534c27}{SetTypeData} ();
61   \hyperlink{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_ab0ae80f5adbf2dedd3346a934baf5943}{m\_testHeader}.\hyperlink{classns3_1_1WifiMacHeader_a84a98932f5b66cca86bdfaa9cb1bcf7b}{SetQosTid} (tid);
62 \}
\end{DoxyCode}


Here is the call graph for this function\+:
% FIG 5




Here is the caller graph for this function\+:
% FIG 6


\index{ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator@{ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator}!Set\+Test\+Length@{Set\+Test\+Length}}
\index{Set\+Test\+Length@{Set\+Test\+Length}!ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator@{ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator}}
\subsubsection[{\texorpdfstring{Set\+Test\+Length(uint16\+\_\+t test\+Length)}{SetTestLength(uint16_t testLength)}}]{\setlength{\rightskip}{0pt plus 5cm}void ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator\+::\+Set\+Test\+Length (
\begin{DoxyParamCaption}
\item[{uint16\+\_\+t}]{test\+Length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\hypertarget{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_abcae7234079e2c8ca360d8fb2b1e85d9}{}\label{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_abcae7234079e2c8ca360d8fb2b1e85d9}
Set number of bytes in test frame (a constant 1024 in the standard) 
\begin{DoxyParams}{Parameters}
{\em test\+Length} & the test length in bits \\
\hline
\end{DoxyParams}

\begin{DoxyCode}
65 \{
66   \hyperlink{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_a28cc4e99da4ac3b38604bc512903b677}{m\_testFrame} = Create<Packet> (testLength + 6 \textcolor{comment}{/*Mesh header*/} + 36 \textcolor{comment}{/*802.11 header*/});
67 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
% FIG 7




\subsection{Member Data Documentation}
\index{ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator@{ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator}!m\+\_\+test\+Frame@{m\+\_\+test\+Frame}}
\index{m\+\_\+test\+Frame@{m\+\_\+test\+Frame}!ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator@{ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator}}
\subsubsection[{\texorpdfstring{m\+\_\+test\+Frame}{m_testFrame}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Ptr}$<${\bf Packet}$>$ ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator\+::m\+\_\+test\+Frame\hspace{0.3cm}{\ttfamily [private]}}\hypertarget{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_a28cc4e99da4ac3b38604bc512903b677}{}\label{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_a28cc4e99da4ac3b38604bc512903b677}


test frame 

\index{ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator@{ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator}!m\+\_\+test\+Header@{m\+\_\+test\+Header}}
\index{m\+\_\+test\+Header@{m\+\_\+test\+Header}!ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator@{ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator}}
\subsubsection[{\texorpdfstring{m\+\_\+test\+Header}{m_testHeader}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Wifi\+Mac\+Header} ns3\+::dot11s\+::\+Airtime\+Link\+Metric\+Calculator\+::m\+\_\+test\+Header\hspace{0.3cm}{\ttfamily [private]}}\hypertarget{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_ab0ae80f5adbf2dedd3346a934baf5943}{}\label{classns3_1_1dot11s_1_1AirtimeLinkMetricCalculator_ab0ae80f5adbf2dedd3346a934baf5943}


test header 



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
mesh/model/dot11s/\hyperlink{airtime-metric_8h}{airtime-\/metric.\+h}\item 
mesh/model/dot11s/\hyperlink{airtime-metric_8cc}{airtime-\/metric.\+cc}\end{DoxyCompactItemize}
