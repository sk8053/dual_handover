\hypertarget{classNs3WimaxFragmentationTestCase}{}\section{Ns3\+Wimax\+Fragmentation\+Test\+Case Class Reference}
\label{classNs3WimaxFragmentationTestCase}\index{Ns3\+Wimax\+Fragmentation\+Test\+Case@{Ns3\+Wimax\+Fragmentation\+Test\+Case}}


Test the wimax packet fragmentation.  




Inheritance diagram for Ns3\+Wimax\+Fragmentation\+Test\+Case\+:
% FIG 0


Collaboration diagram for Ns3\+Wimax\+Fragmentation\+Test\+Case\+:
% FIG 1
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classNs3WimaxFragmentationTestCase_a101615ede7f90f86c8ee5b469b0a2883}{Ns3\+Wimax\+Fragmentation\+Test\+Case} ()
\item 
virtual \hyperlink{classNs3WimaxFragmentationTestCase_a8985d99e17ab81053c37b85348b1bb2a}{$\sim$\+Ns3\+Wimax\+Fragmentation\+Test\+Case} ()
\end{DoxyCompactItemize}
\subsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
virtual void \hyperlink{classNs3WimaxFragmentationTestCase_ac4725340138d07d67dbb72aaa5ccd84b}{Do\+Run} (void)
\begin{DoxyCompactList}\small\item\em Implementation to actually run this Test\+Case. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Additional Inherited Members}


\subsection{Detailed Description}
Test the wimax packet fragmentation. 

\subsection{Constructor \& Destructor Documentation}
\index{Ns3\+Wimax\+Fragmentation\+Test\+Case@{Ns3\+Wimax\+Fragmentation\+Test\+Case}!Ns3\+Wimax\+Fragmentation\+Test\+Case@{Ns3\+Wimax\+Fragmentation\+Test\+Case}}
\index{Ns3\+Wimax\+Fragmentation\+Test\+Case@{Ns3\+Wimax\+Fragmentation\+Test\+Case}!Ns3\+Wimax\+Fragmentation\+Test\+Case@{Ns3\+Wimax\+Fragmentation\+Test\+Case}}
\subsubsection[{\texorpdfstring{Ns3\+Wimax\+Fragmentation\+Test\+Case()}{Ns3WimaxFragmentationTestCase()}}]{\setlength{\rightskip}{0pt plus 5cm}Ns3\+Wimax\+Fragmentation\+Test\+Case\+::\+Ns3\+Wimax\+Fragmentation\+Test\+Case (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{classNs3WimaxFragmentationTestCase_a101615ede7f90f86c8ee5b469b0a2883}{}\label{classNs3WimaxFragmentationTestCase_a101615ede7f90f86c8ee5b469b0a2883}

\begin{DoxyCode}
51   : \hyperlink{classns3_1_1TestCase_a3b0b91a96aac1933e8d146e019b9e207}{TestCase} (\textcolor{stringliteral}{"Test the packet fragmentation and defragmentation."})
52 \{
53 \}
\end{DoxyCode}
\index{Ns3\+Wimax\+Fragmentation\+Test\+Case@{Ns3\+Wimax\+Fragmentation\+Test\+Case}!````~Ns3\+Wimax\+Fragmentation\+Test\+Case@{$\sim$\+Ns3\+Wimax\+Fragmentation\+Test\+Case}}
\index{````~Ns3\+Wimax\+Fragmentation\+Test\+Case@{$\sim$\+Ns3\+Wimax\+Fragmentation\+Test\+Case}!Ns3\+Wimax\+Fragmentation\+Test\+Case@{Ns3\+Wimax\+Fragmentation\+Test\+Case}}
\subsubsection[{\texorpdfstring{$\sim$\+Ns3\+Wimax\+Fragmentation\+Test\+Case()}{~Ns3WimaxFragmentationTestCase()}}]{\setlength{\rightskip}{0pt plus 5cm}Ns3\+Wimax\+Fragmentation\+Test\+Case\+::$\sim$\+Ns3\+Wimax\+Fragmentation\+Test\+Case (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [virtual]}}\hypertarget{classNs3WimaxFragmentationTestCase_a8985d99e17ab81053c37b85348b1bb2a}{}\label{classNs3WimaxFragmentationTestCase_a8985d99e17ab81053c37b85348b1bb2a}

\begin{DoxyCode}
56 \{
57 \}
\end{DoxyCode}


\subsection{Member Function Documentation}
\index{Ns3\+Wimax\+Fragmentation\+Test\+Case@{Ns3\+Wimax\+Fragmentation\+Test\+Case}!Do\+Run@{Do\+Run}}
\index{Do\+Run@{Do\+Run}!Ns3\+Wimax\+Fragmentation\+Test\+Case@{Ns3\+Wimax\+Fragmentation\+Test\+Case}}
\subsubsection[{\texorpdfstring{Do\+Run(void)}{DoRun(void)}}]{\setlength{\rightskip}{0pt plus 5cm}void Ns3\+Wimax\+Fragmentation\+Test\+Case\+::\+Do\+Run (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}, {\ttfamily [virtual]}}\hypertarget{classNs3WimaxFragmentationTestCase_ac4725340138d07d67dbb72aaa5ccd84b}{}\label{classNs3WimaxFragmentationTestCase_ac4725340138d07d67dbb72aaa5ccd84b}


Implementation to actually run this Test\+Case. 

Subclasses should override this method to conduct their tests. 

Implements \hyperlink{classns3_1_1TestCase_a8ff74680cf017ed42011e4be51917a24}{ns3\+::\+Test\+Case}.


\begin{DoxyCode}
61 \{
62   \hyperlink{classns3_1_1GenericMacHeader}{GenericMacHeader} gnrcMacHdr;
63   \hyperlink{classns3_1_1ManagementMessageType}{ManagementMessageType} msgType;
64   \hyperlink{classns3_1_1FragmentationSubheader}{FragmentationSubheader} fragSubhdr;
65   \hyperlink{classns3_1_1GenericMacHeader}{GenericMacHeader} hdr;
66 
67   \hyperlink{classns3_1_1Cid}{Cid} cid;
68   \hyperlink{classns3_1_1WimaxConnection}{WimaxConnection} *connectionTx = \textcolor{keyword}{new} \hyperlink{classns3_1_1WimaxConnection}{WimaxConnection} (cid, Cid::TRANSPORT);
69   \hyperlink{classns3_1_1WimaxConnection}{WimaxConnection} *connectionRx = \textcolor{keyword}{new} \hyperlink{classns3_1_1WimaxConnection}{WimaxConnection} (cid, Cid::TRANSPORT);
70 
71   \textcolor{comment}{// A Packet of 1000 bytes has been created.}
72   \textcolor{comment}{// It will be fragmentated into 4 fragments and then defragmentated into fullPacket.}
73   \hyperlink{classns3_1_1Ptr}{Ptr<Packet>} packet = Create<Packet> (1000);
74   \hyperlink{classns3_1_1Ptr}{Ptr<Packet>} fragment;
75   \hyperlink{classns3_1_1Ptr}{Ptr<Packet>} fullPacket = Create<Packet> ();
76 
77   \textcolor{comment}{// Enqueued packet}
78   hdr.\hyperlink{classns3_1_1GenericMacHeader_ad0b87b780d222778c78b783f7f4e5237}{SetLen} (packet->\hyperlink{classns3_1_1Packet_a462855c9929954d4301a4edfe55f4f1c}{GetSize} () + hdr.\hyperlink{classns3_1_1GenericMacHeader_a406a3aea98a270418d62587315c50deb}{GetSerializedSize} ());
79   hdr.\hyperlink{classns3_1_1GenericMacHeader_adb74c3c234787de22682103cba562d83}{SetCid} (connectionTx->\hyperlink{classns3_1_1WimaxConnection_a22540186bbe5e147236390df0232a797}{GetCid} ());
80   \hyperlink{classns3_1_1MacHeaderType_a54d8fc8bc93a2b7865627965cdd31c20}{MacHeaderType::HeaderType} packetType = MacHeaderType::HEADER\_TYPE\_GENERIC;
81 
82   connectionTx->\hyperlink{classns3_1_1WimaxConnection_a2f7f3bf452c58c3390a096e1b354a86f}{Enqueue} (packet, packetType, hdr);
83 
84   uint32\_t availableByteForFragment = 280;
85   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \hyperlink{bernuolliDistribution_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i} = 0; \hyperlink{bernuolliDistribution_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i} < 4; \hyperlink{bernuolliDistribution_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}++)
86     \{
87       \textcolor{comment}{// dequeue a fragment}
88       \textcolor{keywordflow}{if} (connectionTx->\hyperlink{classns3_1_1WimaxConnection_a5df7525db9277d05f62e3620f9ae4058}{GetQueue} ()->GetFirstPacketRequiredByte (packetType) > 
      availableByteForFragment)
89         \{
90           fragment = connectionTx->\hyperlink{classns3_1_1WimaxConnection_a54b822cae000f9acd50c63f59219ab6a}{Dequeue} (packetType, availableByteForFragment);
91         \}
92       \textcolor{keywordflow}{else}
93         \{
94           fragment = connectionTx->\hyperlink{classns3_1_1WimaxConnection_a54b822cae000f9acd50c63f59219ab6a}{Dequeue} (packetType);
95         \}
96 \textcolor{comment}{// *** send packet -----> receive packet ----**}
97 
98       \textcolor{comment}{// check if receive packet is a fragment}
99       fragment->\hyperlink{classns3_1_1Packet_a0961eccf975d75f902d40956c93ba63e}{RemoveHeader} (gnrcMacHdr);
100       uint8\_t \hyperlink{visualizer-ideas_8txt_add98db9e15e2a58cf2b57623e7aa893a}{type} = gnrcMacHdr.\hyperlink{classns3_1_1GenericMacHeader_aa0145e7dc78803c1193edb55307bb1a4}{GetType} ();
101       \textcolor{keywordflow}{if} (type)
102         \{
103           \textcolor{comment}{// Check if there is a fragmentation Subheader}
104           \hyperlink{group__testing_ga7304ba46a28d8cf08dfdfd6499cf7068}{NS\_TEST\_EXPECT\_MSG\_EQ} (((type >> 2) & 1), 1, \textcolor{stringliteral}{"The packet is not a fragment"})
      ;
105         \}
106 
107       \textcolor{comment}{// remove header from the received fragment}
108       fragment->RemoveHeader (fragSubhdr);
109       uint32\_t \hyperlink{generate__test__data__lte__spectrum__model_8m_a72d54db2b27ce046aab6e6a414c407e9}{fc} = fragSubhdr.\hyperlink{classns3_1_1FragmentationSubheader_ad796f851f0da640a5e732be1e28dc15d}{GetFc} ();
110 
111       \hyperlink{group__testing_ga7304ba46a28d8cf08dfdfd6499cf7068}{NS\_TEST\_EXPECT\_MSG\_EQ} ((fc == 1 && \hyperlink{bernuolliDistribution_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i} != 0), \textcolor{keyword}{false}, \textcolor{stringliteral}{"The fragment in not the
       first one"});
112       \hyperlink{group__testing_ga7304ba46a28d8cf08dfdfd6499cf7068}{NS\_TEST\_EXPECT\_MSG\_EQ} ((fc == 2 && \hyperlink{bernuolliDistribution_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i} != 3), \textcolor{keyword}{false}, \textcolor{stringliteral}{"The fragment in not the
       latest one"});
113       \hyperlink{group__testing_ga7304ba46a28d8cf08dfdfd6499cf7068}{NS\_TEST\_EXPECT\_MSG\_EQ} (((fc == 3 && \hyperlink{bernuolliDistribution_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i} != 1) && (fc == 3 && 
      \hyperlink{bernuolliDistribution_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i} != 2)), \textcolor{keyword}{false}, \textcolor{stringliteral}{"The fragment in not the middle one"});
114 
115       \textcolor{keywordflow}{if} (fc != 2)
116         \{
117           \textcolor{comment}{// This is the first or middle fragment.}
118           \textcolor{comment}{// Take the fragment queue, store the fragment into the queue}
119           connectionRx->\hyperlink{classns3_1_1WimaxConnection_ae7d985915012a837359aa62413457045}{FragmentEnqueue} (fragment);
120         \}
121       \textcolor{keywordflow}{else}
122         \{
123           \textcolor{comment}{// This is the latest fragment.}
124           \textcolor{comment}{// Take the fragment queue, defragment a packet and send it to the upper layer}
125           connectionRx->\hyperlink{classns3_1_1WimaxConnection_ae7d985915012a837359aa62413457045}{FragmentEnqueue} (fragment);
126           \hyperlink{classns3_1_1WimaxConnection_acebd6aa95ab519f5e19bd1773f62e506}{WimaxConnection::FragmentsQueue} fragmentsQueue = connectionRx->
      \hyperlink{classns3_1_1WimaxConnection_adeb165ef2cb04d19edacf92d5c751cc6}{GetFragmentsQueue} ();
127 
128           \textcolor{comment}{// DEFRAGMENTATION}
129           \textcolor{keywordflow}{for} (\hyperlink{openflow-interface_8h_afd9bcfa176617760671b67580f536fa7}{std::list}<\hyperlink{classns3_1_1Ptr}{Ptr<const Packet>} >::const\_iterator iter = 
      fragmentsQueue.begin ();
130                iter != fragmentsQueue.end (); ++iter)
131             \{
132               \textcolor{comment}{// Create the whole Packet}
133               fullPacket->\hyperlink{classns3_1_1Packet_a14ec3d4250b425468764de58f5837b6b}{AddAtEnd} (*iter);
134             \}
135           connectionRx->\hyperlink{classns3_1_1WimaxConnection_a819008b698dd34be127c294c2ec1a198}{ClearFragmentsQueue} ();
136 
137           \hyperlink{group__testing_ga7304ba46a28d8cf08dfdfd6499cf7068}{NS\_TEST\_EXPECT\_MSG\_EQ} (fullPacket->\hyperlink{classns3_1_1Packet_a462855c9929954d4301a4edfe55f4f1c}{GetSize} (), 1000, \textcolor{stringliteral}{"The
       defragmentation is incorrect"});
138         \}
139     \}
140   \textcolor{keyword}{delete} connectionTx;
141   \textcolor{keyword}{delete} connectionRx;
142   Simulator::Destroy ();
143 \}
\end{DoxyCode}


Here is the call graph for this function\+:
% FIG 2




The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
wimax/test/\hyperlink{wimax-fragmentation-test_8cc}{wimax-\/fragmentation-\/test.\+cc}\end{DoxyCompactItemize}
