\hypertarget{classRecordHeaderTestCase}{}\section{Record\+Header\+Test\+Case Class Reference}
\label{classRecordHeaderTestCase}\index{Record\+Header\+Test\+Case@{Record\+Header\+Test\+Case}}


Inheritance diagram for Record\+Header\+Test\+Case\+:
% FIG 0


Collaboration diagram for Record\+Header\+Test\+Case\+:
% FIG 1
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classRecordHeaderTestCase_aa0fb3827579ea3b8023609bbf1045ffb}{Record\+Header\+Test\+Case} ()
\item 
virtual \hyperlink{classRecordHeaderTestCase_a0ad70013e458684964a07770366ad4e9}{$\sim$\+Record\+Header\+Test\+Case} ()
\end{DoxyCompactItemize}
\subsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
virtual void \hyperlink{classRecordHeaderTestCase_aad4a302ea73173b4c70902a897933b04}{Do\+Setup} (void)
\begin{DoxyCompactList}\small\item\em Implementation to do any local setup required for this Test\+Case. \end{DoxyCompactList}\item 
virtual void \hyperlink{classRecordHeaderTestCase_aaf35f7eec6dee5bbf435fe7807287491}{Do\+Run} (void)
\begin{DoxyCompactList}\small\item\em Implementation to actually run this Test\+Case. \end{DoxyCompactList}\item 
virtual void \hyperlink{classRecordHeaderTestCase_aa51bec063ad3fac6ccf2b6d3e7d51bed}{Do\+Teardown} (void)
\begin{DoxyCompactList}\small\item\em Implementation to do any local setup required for this Test\+Case. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
std\+::string \hyperlink{classRecordHeaderTestCase_a120cda070e5262333c795ce77359528e}{m\+\_\+test\+Filename}
\end{DoxyCompactItemize}
\subsection*{Additional Inherited Members}


\subsection{Constructor \& Destructor Documentation}
\index{Record\+Header\+Test\+Case@{Record\+Header\+Test\+Case}!Record\+Header\+Test\+Case@{Record\+Header\+Test\+Case}}
\index{Record\+Header\+Test\+Case@{Record\+Header\+Test\+Case}!Record\+Header\+Test\+Case@{Record\+Header\+Test\+Case}}
\subsubsection[{\texorpdfstring{Record\+Header\+Test\+Case()}{RecordHeaderTestCase()}}]{\setlength{\rightskip}{0pt plus 5cm}Record\+Header\+Test\+Case\+::\+Record\+Header\+Test\+Case (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{classRecordHeaderTestCase_aa0fb3827579ea3b8023609bbf1045ffb}{}\label{classRecordHeaderTestCase_aa0fb3827579ea3b8023609bbf1045ffb}

\begin{DoxyCode}
672   : \hyperlink{classns3_1_1TestCase_a3b0b91a96aac1933e8d146e019b9e207}{TestCase} (\textcolor{stringliteral}{"Check to see that PcapRecordHeader is managed correctly"})
673 \{
674 \}
\end{DoxyCode}
\index{Record\+Header\+Test\+Case@{Record\+Header\+Test\+Case}!````~Record\+Header\+Test\+Case@{$\sim$\+Record\+Header\+Test\+Case}}
\index{````~Record\+Header\+Test\+Case@{$\sim$\+Record\+Header\+Test\+Case}!Record\+Header\+Test\+Case@{Record\+Header\+Test\+Case}}
\subsubsection[{\texorpdfstring{$\sim$\+Record\+Header\+Test\+Case()}{~RecordHeaderTestCase()}}]{\setlength{\rightskip}{0pt plus 5cm}Record\+Header\+Test\+Case\+::$\sim$\+Record\+Header\+Test\+Case (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [virtual]}}\hypertarget{classRecordHeaderTestCase_a0ad70013e458684964a07770366ad4e9}{}\label{classRecordHeaderTestCase_a0ad70013e458684964a07770366ad4e9}

\begin{DoxyCode}
677 \{
678 \}
\end{DoxyCode}


\subsection{Member Function Documentation}
\index{Record\+Header\+Test\+Case@{Record\+Header\+Test\+Case}!Do\+Run@{Do\+Run}}
\index{Do\+Run@{Do\+Run}!Record\+Header\+Test\+Case@{Record\+Header\+Test\+Case}}
\subsubsection[{\texorpdfstring{Do\+Run(void)}{DoRun(void)}}]{\setlength{\rightskip}{0pt plus 5cm}void Record\+Header\+Test\+Case\+::\+Do\+Run (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}, {\ttfamily [virtual]}}\hypertarget{classRecordHeaderTestCase_aaf35f7eec6dee5bbf435fe7807287491}{}\label{classRecordHeaderTestCase_aaf35f7eec6dee5bbf435fe7807287491}


Implementation to actually run this Test\+Case. 

Subclasses should override this method to conduct their tests. 

Implements \hyperlink{classns3_1_1TestCase_a8ff74680cf017ed42011e4be51917a24}{ns3\+::\+Test\+Case}.


\begin{DoxyCode}
700 \{
701   \hyperlink{classns3_1_1PcapFile}{PcapFile} \hyperlink{buildings__pathloss_8m_aa52d3a6e3de5a80a97c12364caeaa125}{f};
702 
703   \textcolor{comment}{//}
704   \textcolor{comment}{// Create an uninitialized file using previously tested operations}
705   \textcolor{comment}{//}
706   f.\hyperlink{classns3_1_1PcapFile_a064e8494e28e823d0bb4e40549f9f483}{Open} (\hyperlink{classRecordHeaderTestCase_a120cda070e5262333c795ce77359528e}{m\_testFilename}, std::ios::out);
707   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (f.\hyperlink{classns3_1_1PcapFile_a2e00aa080890a0c9c3e9f5bd2d6c21d5}{Fail} (), \textcolor{keyword}{false}, \textcolor{stringliteral}{"Open ("} << 
      \hyperlink{classRecordHeaderTestCase_a120cda070e5262333c795ce77359528e}{m\_testFilename} << 
708                          \textcolor{stringliteral}{", \(\backslash\)"std::ios::out\(\backslash\)") returns error"});
709 
710   \textcolor{comment}{//}
711   \textcolor{comment}{// Initialize the pcap file header.}
712   \textcolor{comment}{//}
713   f.\hyperlink{classns3_1_1PcapFile_a80c8adea1baa66e3f730df2927b0fc9b}{Init} (37, 43, -7);
714   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (f.\hyperlink{classns3_1_1PcapFile_a2e00aa080890a0c9c3e9f5bd2d6c21d5}{Fail} (), \textcolor{keyword}{false}, \textcolor{stringliteral}{"Init (37, 43, -7) returns error"});
715 
716   \textcolor{comment}{//}
717   \textcolor{comment}{// Initialize a buffer with a counting pattern to check the data later.}
718   \textcolor{comment}{//}
719   uint8\_t bufferOut[128];
720   \textcolor{keywordflow}{for} (uint32\_t \hyperlink{bernuolliDistribution_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i} = 0; \hyperlink{bernuolliDistribution_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i} < 128; ++\hyperlink{bernuolliDistribution_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i})
721     \{
722       bufferOut[\hyperlink{bernuolliDistribution_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}] = \hyperlink{bernuolliDistribution_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i};
723     \}
724 
725   \textcolor{comment}{//}
726   \textcolor{comment}{// Now we should be able to write a packet to it since it was opened in "w" }
727   \textcolor{comment}{// mode.  The packet data written should be limited to 43 bytes in length }
728   \textcolor{comment}{// by the Init() call above.}
729   \textcolor{comment}{//}
730   f.\hyperlink{classns3_1_1PcapFile_a3920f5bae95ca0021875e6e9c2630ccf}{Write} (1234, 5678, bufferOut, 128);
731   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (f.\hyperlink{classns3_1_1PcapFile_a2e00aa080890a0c9c3e9f5bd2d6c21d5}{Fail} (), \textcolor{keyword}{false}, \textcolor{stringliteral}{"Write (write-only-file "} << 
      \hyperlink{classRecordHeaderTestCase_a120cda070e5262333c795ce77359528e}{m\_testFilename} << \textcolor{stringliteral}{") returns error"});
732   f.\hyperlink{classns3_1_1PcapFile_ad3b6c28d464742ee1fa3a64628339a5b}{Close} ();
733 
734   \textcolor{comment}{//}
735   \textcolor{comment}{// Let's peek into the file and see what actually went out for that}
736   \textcolor{comment}{// packet.}
737   \textcolor{comment}{//}
738   FILE *\hyperlink{lte__link__budget_8m_ac9de518908a968428863f829398a4e62}{p} = std::fopen (\hyperlink{classRecordHeaderTestCase_a120cda070e5262333c795ce77359528e}{m\_testFilename}.c\_str (), \textcolor{stringliteral}{"r+b"});
739   \hyperlink{group__testing_ga73d66fb0050a5111453fd144e767b91a}{NS\_TEST\_ASSERT\_MSG\_NE} (p, 0, \textcolor{stringliteral}{"fopen() should have been able to open a correctly
       created pcap file"});
740 
741   \textcolor{comment}{//}
742   \textcolor{comment}{// A pcap file header takes up 24 bytes, a pcap record header takes up 16 bytes}
743   \textcolor{comment}{// and we wrote in 43 bytes, so the file must be 83 bytes long.  Let's just}
744   \textcolor{comment}{// double check that this is exactly what happened.}
745   \textcolor{comment}{//}
746   std::fseek (p, 0, SEEK\_END);
747   uint64\_t size = std::ftell (p);
748   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (size, 83, \textcolor{stringliteral}{"Pcap file with one 43 byte packet is incorrect
       size"});
749 
750   \textcolor{comment}{//}
751   \textcolor{comment}{// A pcap file header takes up 24 bytes, so we should see a pcap record header}
752   \textcolor{comment}{// starting there in the file.  We've tested this all before so we just assume}
753   \textcolor{comment}{// it's all right and just seek to just past that point..}
754   \textcolor{comment}{//}
755   std::fseek (p, 24, SEEK\_SET);
756 
757   uint32\_t val32;
758 
759   \textcolor{comment}{//}
760   \textcolor{comment}{// Because the regression tests require that pcap file output be compared }
761   \textcolor{comment}{// byte-by-byte, we had to decide on a single format for written pcap files.}
762   \textcolor{comment}{// This was little endian.  So we have to do something special with big-}
763   \textcolor{comment}{// endian machines here.}
764   \textcolor{comment}{//}
765   \textcolor{comment}{// When a big endian machine writes a pcap file, it is forced into swap}
766   \textcolor{comment}{// mode and actually writes little endian files.  This is automagically}
767   \textcolor{comment}{// fixed up when using a PcapFile to read the values, but when a big-}
768   \textcolor{comment}{// endian machine reads these values directly, they will be swapped.}
769   \textcolor{comment}{//}
770   \textcolor{comment}{// We can remove this nonsense when we get rid of the pcap-file-comparison}
771   \textcolor{comment}{// regression tests.}
772   \textcolor{comment}{//}
773   \textcolor{comment}{// So, determine the endian-ness of the running system, and if we're on}
774   \textcolor{comment}{// a big-endian machine, swap all of the results below before checking.}
775   \textcolor{comment}{//}
776   \textcolor{keyword}{union }\{
777     uint32\_t a;
778     uint8\_t  \hyperlink{buildings__pathloss_8m_a21ad0bd836b90d08f4cf640b4c298e7c}{b}[4];
779   \} u;
780 
781   u.a = 1;
782   \textcolor{keywordtype}{bool} bigEndian = u.b[3];
783 
784   \textcolor{keywordtype}{size\_t} result = std::fread (&val32, \textcolor{keyword}{sizeof}(val32), 1, p);
785   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (result, 1, \textcolor{stringliteral}{"Unable to fread() seconds timestamp"});
786   \textcolor{keywordflow}{if} (bigEndian) val32 = \hyperlink{pcap-file-test-suite_8cc_a9baeceaeb66adfc7bddae33a81ad8fa7}{Swap} (val32);
787   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (val32, 1234, \textcolor{stringliteral}{"Seconds timestamp written incorrectly"});
788 
789   result = std::fread (&val32, \textcolor{keyword}{sizeof}(val32), 1, p);
790   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (result, 1, \textcolor{stringliteral}{"Unable to fread() microseconds timestamp"});
791   \textcolor{keywordflow}{if} (bigEndian) val32 = \hyperlink{pcap-file-test-suite_8cc_a9baeceaeb66adfc7bddae33a81ad8fa7}{Swap} (val32);
792   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (val32, 5678, \textcolor{stringliteral}{"Microseconds timestamp written incorrectly"});
793 
794   result = std::fread (&val32, \textcolor{keyword}{sizeof}(val32), 1, p);
795   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (result, 1, \textcolor{stringliteral}{"Unable to fread() included length"});
796   \textcolor{keywordflow}{if} (bigEndian) val32 = \hyperlink{pcap-file-test-suite_8cc_a9baeceaeb66adfc7bddae33a81ad8fa7}{Swap} (val32);
797   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (val32, 43, \textcolor{stringliteral}{"Included length written incorrectly"});
798 
799   result = std::fread (&val32, \textcolor{keyword}{sizeof}(val32), 1, p);
800   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (result, 1, \textcolor{stringliteral}{"Unable to fread() actual length"});
801   \textcolor{keywordflow}{if} (bigEndian) val32 = \hyperlink{pcap-file-test-suite_8cc_a9baeceaeb66adfc7bddae33a81ad8fa7}{Swap} (val32);
802   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (val32, 128, \textcolor{stringliteral}{"Actual length written incorrectly"});
803 
804   \textcolor{comment}{//}
805   \textcolor{comment}{// Take a look and see what went out into the file.  The packet data}
806   \textcolor{comment}{// should be unchanged (unswapped).}
807   \textcolor{comment}{//}
808   uint8\_t bufferIn[128];
809 
810   result = std::fread (bufferIn, 1, 43, p);
811   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (result, 43, \textcolor{stringliteral}{"Unable to fread() packet data of expected length
      "});
812 
813   \textcolor{keywordflow}{for} (uint32\_t \hyperlink{bernuolliDistribution_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i} = 0; \hyperlink{bernuolliDistribution_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i} < 43; ++\hyperlink{bernuolliDistribution_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i})
814     \{
815       \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (bufferIn[\hyperlink{bernuolliDistribution_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}], bufferOut[i], \textcolor{stringliteral}{"Incorrect packet data
       written"});
816     \}
817 
818   std::fclose (p);
819   p = 0;
820 
821   \textcolor{comment}{//}
822   \textcolor{comment}{// Let's see if the PcapFile object can figure out how to do the same thing and}
823   \textcolor{comment}{// correctly read in a packet.}
824   \textcolor{comment}{//}
825   f.\hyperlink{classns3_1_1PcapFile_a064e8494e28e823d0bb4e40549f9f483}{Open} (\hyperlink{classRecordHeaderTestCase_a120cda070e5262333c795ce77359528e}{m\_testFilename}, std::ios::in);
826   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (f.\hyperlink{classns3_1_1PcapFile_a2e00aa080890a0c9c3e9f5bd2d6c21d5}{Fail} (), \textcolor{keyword}{false}, \textcolor{stringliteral}{"Open ("} << 
      \hyperlink{classRecordHeaderTestCase_a120cda070e5262333c795ce77359528e}{m\_testFilename} << 
827                          \textcolor{stringliteral}{", \(\backslash\)"std::ios::in\(\backslash\)") of existing good file returns error"});
828 
829   uint32\_t tsSec, tsUsec, inclLen, origLen, readLen;
830 
831   f.\hyperlink{classns3_1_1PcapFile_a18c5045735408fe45a8cbc9e6b34a4fb}{Read} (bufferIn, \textcolor{keyword}{sizeof}(bufferIn), tsSec, tsUsec, inclLen, origLen, readLen);
832   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (f.\hyperlink{classns3_1_1PcapFile_a2e00aa080890a0c9c3e9f5bd2d6c21d5}{Fail} (), \textcolor{keyword}{false}, \textcolor{stringliteral}{"Read() of known good packet returns
       error"});
833   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (tsSec, 1234, \textcolor{stringliteral}{"Incorrectly read seconds timestap from known
       good packet"});
834   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (tsUsec, 5678, \textcolor{stringliteral}{"Incorrectly read microseconds timestap from
       known good packet"});
835   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (inclLen, 43, \textcolor{stringliteral}{"Incorrectly read included length from known
       good packet"});
836   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (origLen, 128, \textcolor{stringliteral}{"Incorrectly read original length from known
       good packet"});
837   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (readLen, 43, \textcolor{stringliteral}{"Incorrectly constructed actual read length from
       known good packet given buffer size"});
838   f.\hyperlink{classns3_1_1PcapFile_ad3b6c28d464742ee1fa3a64628339a5b}{Close} ();
839 
840   \textcolor{comment}{//}
841   \textcolor{comment}{// Did the data come back correctly?}
842   \textcolor{comment}{//}
843   \textcolor{keywordflow}{for} (uint32\_t \hyperlink{bernuolliDistribution_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i} = 0; \hyperlink{bernuolliDistribution_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i} < 43; ++\hyperlink{bernuolliDistribution_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i})
844     \{
845       \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (bufferIn[\hyperlink{bernuolliDistribution_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}], bufferOut[i], \textcolor{stringliteral}{"Incorrect packet data read
       from known good packet"});
846     \}
847 
848   \textcolor{comment}{//}
849   \textcolor{comment}{// We have to check to make sure that the pcap record header is swapped }
850   \textcolor{comment}{// correctly.  Since big-endian machines are automatically forced into }
851   \textcolor{comment}{// swap mode, the <true> parameter to f.Init() below is actually}
852   \textcolor{comment}{// a no-op and we're always writing foreign-endian files.  In that case, }
853   \textcolor{comment}{// this test case is really just a duplicate of the previous.}
854   \textcolor{comment}{//}
855   \textcolor{comment}{// Open the file in write mode to clear the data.}
856   \textcolor{comment}{//}
857   f.\hyperlink{classns3_1_1PcapFile_a064e8494e28e823d0bb4e40549f9f483}{Open} (\hyperlink{classRecordHeaderTestCase_a120cda070e5262333c795ce77359528e}{m\_testFilename}, std::ios::out);
858   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (f.\hyperlink{classns3_1_1PcapFile_a2e00aa080890a0c9c3e9f5bd2d6c21d5}{Fail} (), \textcolor{keyword}{false}, \textcolor{stringliteral}{"Open ("} << 
      \hyperlink{classRecordHeaderTestCase_a120cda070e5262333c795ce77359528e}{m\_testFilename} << 
859                          \textcolor{stringliteral}{", \(\backslash\)"std::ios::out\(\backslash\)") returns error"});
860 
861   \textcolor{comment}{//}
862   \textcolor{comment}{// Initialize the pcap file header, forcing the object into swap mode.}
863   \textcolor{comment}{//}
864   f.\hyperlink{classns3_1_1PcapFile_a80c8adea1baa66e3f730df2927b0fc9b}{Init} (37, 43, -7, \textcolor{keyword}{true});
865   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (f.\hyperlink{classns3_1_1PcapFile_a2e00aa080890a0c9c3e9f5bd2d6c21d5}{Fail} (), \textcolor{keyword}{false}, \textcolor{stringliteral}{"Init (37, 43, -7) returns error"});
866 
867   \textcolor{comment}{//}
868   \textcolor{comment}{// Now we should be able to write a packet to it since it was opened in "w" }
869   \textcolor{comment}{// mode.  The packet data written should be limited to 43 bytes in length }
870   \textcolor{comment}{// by the Init() call above.}
871   \textcolor{comment}{//}
872   f.\hyperlink{classns3_1_1PcapFile_a3920f5bae95ca0021875e6e9c2630ccf}{Write} (1234, 5678, bufferOut, 128);
873   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (f.\hyperlink{classns3_1_1PcapFile_a2e00aa080890a0c9c3e9f5bd2d6c21d5}{Fail} (), \textcolor{keyword}{false}, \textcolor{stringliteral}{"Write (write-only-file "} << 
      \hyperlink{classRecordHeaderTestCase_a120cda070e5262333c795ce77359528e}{m\_testFilename} << \textcolor{stringliteral}{") returns error"});
874   f.\hyperlink{classns3_1_1PcapFile_ad3b6c28d464742ee1fa3a64628339a5b}{Close} ();
875 
876   \textcolor{comment}{//}
877   \textcolor{comment}{// Let's peek into the file and see what actually went out for that}
878   \textcolor{comment}{// packet.}
879   \textcolor{comment}{//}
880   p = std::fopen (\hyperlink{classRecordHeaderTestCase_a120cda070e5262333c795ce77359528e}{m\_testFilename}.c\_str (), \textcolor{stringliteral}{"r+b"});
881   \hyperlink{group__testing_ga73d66fb0050a5111453fd144e767b91a}{NS\_TEST\_ASSERT\_MSG\_NE} (p, 0, \textcolor{stringliteral}{"fopen() should have been able to open a correctly
       created pcap file"});
882 
883   \textcolor{comment}{//}
884   \textcolor{comment}{// A pcap file header takes up 24 bytes, a pcap record header takes up 16 bytes}
885   \textcolor{comment}{// and we wrote in 43 bytes, so the file must be 83 bytes long.  Let's just}
886   \textcolor{comment}{// double check that this is exactly what happened.}
887   \textcolor{comment}{//}
888   std::fseek (p, 0, SEEK\_END);
889   size = std::ftell (p);
890   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (size, 83, \textcolor{stringliteral}{"Pcap file with one 43 byte packet is incorrect
       size"});
891 
892   \textcolor{comment}{//}
893   \textcolor{comment}{// A pcap file header takes up 24 bytes, so we should see a pcap record header}
894   \textcolor{comment}{// starting there in the file.  We've tested this all before so we just assume}
895   \textcolor{comment}{// it's all right and just seek past it.}
896   \textcolor{comment}{//}
897   result = std::fseek (p, 24, SEEK\_SET);
898   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (result, 0, \textcolor{stringliteral}{"Failed seeking past pcap header"});
899 
900   result = std::fread (&val32, \textcolor{keyword}{sizeof}(val32), 1, p);
901   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (result, 1, \textcolor{stringliteral}{"Unable to fread() seconds timestamp"});
902   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (val32, \hyperlink{pcap-file-test-suite_8cc_a9baeceaeb66adfc7bddae33a81ad8fa7}{Swap} (uint32\_t (1234)), \textcolor{stringliteral}{"Swapped seconds timestamp
       written incorrectly"});
903 
904   result = std::fread (&val32, \textcolor{keyword}{sizeof}(val32), 1, p);
905   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (result, 1, \textcolor{stringliteral}{"Unable to fread() microseconds timestamp"});
906   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (val32, \hyperlink{pcap-file-test-suite_8cc_a9baeceaeb66adfc7bddae33a81ad8fa7}{Swap} (uint32\_t (5678)), \textcolor{stringliteral}{"Swapped microseconds
       timestamp written incorrectly"});
907 
908   result = std::fread (&val32, \textcolor{keyword}{sizeof}(val32), 1, p);
909   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (result, 1, \textcolor{stringliteral}{"Unable to fread() included length"});
910   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (val32, \hyperlink{pcap-file-test-suite_8cc_a9baeceaeb66adfc7bddae33a81ad8fa7}{Swap} (uint32\_t (43)), \textcolor{stringliteral}{"Swapped included length
       written incorrectly"});
911 
912   result = std::fread (&val32, \textcolor{keyword}{sizeof}(val32), 1, p);
913   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (result, 1, \textcolor{stringliteral}{"Unable to fread() actual length"});
914   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (val32, \hyperlink{pcap-file-test-suite_8cc_a9baeceaeb66adfc7bddae33a81ad8fa7}{Swap} (uint32\_t (128)), \textcolor{stringliteral}{"Swapped Actual length
       written incorrectly"});
915 
916   \textcolor{comment}{//}
917   \textcolor{comment}{// Take a look and see what went out into the file.  The packet data}
918   \textcolor{comment}{// should be unchanged (unswapped).}
919   \textcolor{comment}{//}
920   result = std::fread (bufferIn, 1, 43, p);
921   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (result, 43, \textcolor{stringliteral}{"Unable to fread() packet data of expected length
      "});
922 
923   \textcolor{keywordflow}{for} (uint32\_t \hyperlink{bernuolliDistribution_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i} = 0; \hyperlink{bernuolliDistribution_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i} < 43; ++\hyperlink{bernuolliDistribution_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i})
924     \{
925       \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (bufferIn[\hyperlink{bernuolliDistribution_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}], bufferOut[i], \textcolor{stringliteral}{"Incorrect packet data
       written"});
926     \}
927 
928   std::fclose (p);
929   p = 0;
930 
931   \textcolor{comment}{//}
932   \textcolor{comment}{// Let's see if the PcapFile object can figure out how to do the same thing and}
933   \textcolor{comment}{// correctly read in a packet.  The record header info should come back to us}
934   \textcolor{comment}{// swapped back into correct form.}
935   \textcolor{comment}{//}
936   f.\hyperlink{classns3_1_1PcapFile_a064e8494e28e823d0bb4e40549f9f483}{Open} (\hyperlink{classRecordHeaderTestCase_a120cda070e5262333c795ce77359528e}{m\_testFilename}, std::ios::in);
937   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (f.\hyperlink{classns3_1_1PcapFile_a2e00aa080890a0c9c3e9f5bd2d6c21d5}{Fail} (), \textcolor{keyword}{false}, \textcolor{stringliteral}{"Open ("} << 
      \hyperlink{classRecordHeaderTestCase_a120cda070e5262333c795ce77359528e}{m\_testFilename} << 
938                          \textcolor{stringliteral}{", \(\backslash\)"std::ios::in\(\backslash\)") of existing good file returns error"});
939 
940   f.\hyperlink{classns3_1_1PcapFile_a18c5045735408fe45a8cbc9e6b34a4fb}{Read} (bufferIn, \textcolor{keyword}{sizeof}(bufferIn), tsSec, tsUsec, inclLen, origLen, readLen);
941   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (f.\hyperlink{classns3_1_1PcapFile_a2e00aa080890a0c9c3e9f5bd2d6c21d5}{Fail} (), \textcolor{keyword}{false}, \textcolor{stringliteral}{"Read() of known good packet returns
       error"});
942   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (tsSec, 1234, \textcolor{stringliteral}{"Incorrectly read seconds timestap from known
       good packet"});
943   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (tsUsec, 5678, \textcolor{stringliteral}{"Incorrectly read microseconds timestap from
       known good packet"});
944   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (inclLen, 43, \textcolor{stringliteral}{"Incorrectly read included length from known
       good packet"});
945   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (origLen, 128, \textcolor{stringliteral}{"Incorrectly read original length from known
       good packet"});
946   \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (readLen, 43, \textcolor{stringliteral}{"Incorrectly constructed actual read length from
       known good packet given buffer size"});
947 
948   \textcolor{comment}{//}
949   \textcolor{comment}{// Did the data come back correctly (unchanged / unswapped)?}
950   \textcolor{comment}{//}
951   \textcolor{keywordflow}{for} (uint32\_t \hyperlink{bernuolliDistribution_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i} = 0; \hyperlink{bernuolliDistribution_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i} < 43; ++\hyperlink{bernuolliDistribution_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i})
952     \{
953       \hyperlink{group__testing_ga2a9d78cffb3db8e867c35fff0b698cf5}{NS\_TEST\_ASSERT\_MSG\_EQ} (bufferIn[\hyperlink{bernuolliDistribution_8m_a6f6ccfcf58b31cb6412107d9d5281426}{i}], bufferOut[i], \textcolor{stringliteral}{"Incorrect packet data read
       from known good packet"});
954     \}
955 
956   f.\hyperlink{classns3_1_1PcapFile_ad3b6c28d464742ee1fa3a64628339a5b}{Close} ();
957 \}
\end{DoxyCode}


Here is the call graph for this function\+:
% FIG 2


\index{Record\+Header\+Test\+Case@{Record\+Header\+Test\+Case}!Do\+Setup@{Do\+Setup}}
\index{Do\+Setup@{Do\+Setup}!Record\+Header\+Test\+Case@{Record\+Header\+Test\+Case}}
\subsubsection[{\texorpdfstring{Do\+Setup(void)}{DoSetup(void)}}]{\setlength{\rightskip}{0pt plus 5cm}void Record\+Header\+Test\+Case\+::\+Do\+Setup (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}, {\ttfamily [virtual]}}\hypertarget{classRecordHeaderTestCase_aad4a302ea73173b4c70902a897933b04}{}\label{classRecordHeaderTestCase_aad4a302ea73173b4c70902a897933b04}


Implementation to do any local setup required for this Test\+Case. 

Subclasses should override this method to perform any costly per-\/test setup before Do\+Run is invoked. 

Reimplemented from \hyperlink{classns3_1_1TestCase_a4a7e32ad32a10a508910815cd38e9177}{ns3\+::\+Test\+Case}.


\begin{DoxyCode}
682 \{
683   std::stringstream filename;
684   uint32\_t \hyperlink{namespacesample-rng-plot_aeb5ee5c431e338ef39b7ac5431242e1d}{n} = rand ();
685   filename << \hyperlink{namespacesample-rng-plot_aeb5ee5c431e338ef39b7ac5431242e1d}{n};
686   \hyperlink{classRecordHeaderTestCase_a120cda070e5262333c795ce77359528e}{m\_testFilename} = \hyperlink{classns3_1_1TestCase_a8a04695a6fb9ba0f89e28e9523963f88}{CreateTempDirFilename} (filename.str () + \textcolor{stringliteral}{".pcap"});
687 \}
\end{DoxyCode}


Here is the call graph for this function\+:
% FIG 3


\index{Record\+Header\+Test\+Case@{Record\+Header\+Test\+Case}!Do\+Teardown@{Do\+Teardown}}
\index{Do\+Teardown@{Do\+Teardown}!Record\+Header\+Test\+Case@{Record\+Header\+Test\+Case}}
\subsubsection[{\texorpdfstring{Do\+Teardown(void)}{DoTeardown(void)}}]{\setlength{\rightskip}{0pt plus 5cm}void Record\+Header\+Test\+Case\+::\+Do\+Teardown (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}, {\ttfamily [virtual]}}\hypertarget{classRecordHeaderTestCase_aa51bec063ad3fac6ccf2b6d3e7d51bed}{}\label{classRecordHeaderTestCase_aa51bec063ad3fac6ccf2b6d3e7d51bed}


Implementation to do any local setup required for this Test\+Case. 

Subclasses should override this method to perform any costly per-\/test teardown 

Reimplemented from \hyperlink{classns3_1_1TestCase_a8917f1604e28d312a8086f76291e3c46}{ns3\+::\+Test\+Case}.


\begin{DoxyCode}
691 \{
692   \textcolor{keywordflow}{if} (\textcolor{keyword}{remove} (\hyperlink{classRecordHeaderTestCase_a120cda070e5262333c795ce77359528e}{m\_testFilename}.c\_str ()))
693     \{
694       \hyperlink{group__logging_ga0261a8db1d4ac5f79417d117634fd455}{NS\_LOG\_ERROR} (\textcolor{stringliteral}{"Failed to delete file "} << \hyperlink{classRecordHeaderTestCase_a120cda070e5262333c795ce77359528e}{m\_testFilename});
695     \}
696 \}
\end{DoxyCode}


\subsection{Member Data Documentation}
\index{Record\+Header\+Test\+Case@{Record\+Header\+Test\+Case}!m\+\_\+test\+Filename@{m\+\_\+test\+Filename}}
\index{m\+\_\+test\+Filename@{m\+\_\+test\+Filename}!Record\+Header\+Test\+Case@{Record\+Header\+Test\+Case}}
\subsubsection[{\texorpdfstring{m\+\_\+test\+Filename}{m_testFilename}}]{\setlength{\rightskip}{0pt plus 5cm}std\+::string Record\+Header\+Test\+Case\+::m\+\_\+test\+Filename\hspace{0.3cm}{\ttfamily [private]}}\hypertarget{classRecordHeaderTestCase_a120cda070e5262333c795ce77359528e}{}\label{classRecordHeaderTestCase_a120cda070e5262333c795ce77359528e}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
network/test/\hyperlink{pcap-file-test-suite_8cc}{pcap-\/file-\/test-\/suite.\+cc}\end{DoxyCompactItemize}
